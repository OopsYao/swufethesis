name: CI
on:
  push:
    branches: main
  pull_request:
    branches: main
jobs:
  linux-texlive:
    name: Linux TeX Live
    runs-on: ubuntu-18.04
    if: "!contains(github.event.head_commit.message, '[skip ci]')"
    steps:
      - name: Checkout
        uses: actions/checkout@v2.3.4
      - name: Cache TeX Live
        uses: actions/cache@v2.1.3
        with:
          path: /tmp/texlive
          key: ${{ runner.os }}-texlive-${{ github.run_id }} # Save the cache every time
          restore-keys: ${{ runner.os }}-texlive-
      - name: Set up PATH
        run: echo "/tmp/texlive/bin/x86_64-linux" >> $GITHUB_PATH
      - name: Check TeX Live
        id: cache-texlive
        run: |
          if command -v texliveonfly &> /dev/null
          then
            echo "::set-output name=installed::true"
          fi
      - name: Download install-tl.zip
        if: steps.cache-texlive.outputs.installed != 'true'
        run: |
          curl -s -O -L http://mirror.ctan.org/systems/texlive/tlnet/install-tl.zip
          unzip -q install-tl.zip
          mv install-tl-2* install-tl-dir
      - name: Run install-tl
        if: steps.cache-texlive.outputs.installed != 'true'
        run: install-tl-dir/install-tl --profile .github/workflows/texlive-linux.profile
      - name: Run tlmgr install
        if: steps.cache-texlive.outputs.installed != 'true'
        run: |
          tlmgr update --self
          tlmgr install latex-bin platex uplatex tex xetex
          tlmgr install latexmk texliveonfly
      - name: Run texliveonfly
        run: texliveonfly -c latexmk example.tex
